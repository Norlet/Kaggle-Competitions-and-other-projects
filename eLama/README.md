# Прогнозирование количества регистраций 

## Описание проекта

В таблице regs.csv находится количество регистраций пользователей в еЛаме по месяцам по июль 2022. Требуется написать Python-скрипт, который прогнозирует количество регистраций в августе 2022.


## Обзор данных

В таблице regs.csv 2 столбца: periods с датами и users с количеством регистраций. Всего в наличии 26 месяцев с данными. 

![Table](https://github.com/Norlet/Kaggle-Competitions/blob/main/eLama/images/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B01.PNG)

Рассмотрим график распределения регистраций по месяцам

![Table_2](https://github.com/Norlet/Kaggle-Competitions/blob/main/eLama/images/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B02.png)

Явно виден локальный максимум в сентябре 2021 года, где количество регистраций достигло 10085 аккаунтов, после чего произошло постепенное снижение значений количества регистраций вплоть до минимального значения в 4175 аккаунтов. 

Рассмотрим также дополнительные графики

![Table_3](https://github.com/Norlet/Kaggle-Competitions/blob/main/eLama/images/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B03.png)

Явно виден тренд на снижение общего количества заказов. 

Далее, проверим временной ряд на стационарность. Используем пороговое значение, равное 0,05 (5%).

P-value оказался явно выше 0,05 (0,86), можем сделать вывод, что ряд нестационарен. 

Так как в исходной таблице практически нет дополнительных полезных столбцов - создадим новые признаки самостоятельно. 
Первый новый признак - время года для каждого месяца. Возможно, события связанные с снижением количества регистраций связаны с сезонными факторами. 

Второй новый признак - количество дней в месяце. 

Третий новый признак - наличие праздничных дней в месяце. 

После добавления новых признаков приступим к разделению данных на тренировочный и тестовый наборы. Сначала попробуем разделить примерно 80:20, однако, возможно, понадобится провести деление иначе, так как, в последних 20 процентах данных заметно серьезное снижение значений количества регистраций, что может повлиять на прогнозы моделей. 

Прежде всего проверим прогноз на наивной модели, которая прогнозирует следующее значение регистраций, основываясь на предыдущем (просто копирует предыдущее значение). 
Показатель MAE у наивной модели = 857.16.

Проверив алгоритмы моделей Lineal Regression, Random Forest и LightGBM, можно сделать вывод, что лучше всех справляется именно LightGBM. 

На тренировочном наборе данных эта модель показала MAE = 976.75 и лучшие параметры: 'n_estimators': 100, 'num_leaves': 20.

На тестовом наборе данных у этой модели показатель MAE = 3465.06

Несмотря на то, что в данных есть резкое снижение значений количества регистраций, результаты можно улучшить, если изменить тренировочный и тестовый наборы. Проблема была в том, что в тренировочном наборе - в среднем значения больше в 2 раза, чем в тестовом, от того предсказания моделей страдают. Создадим новый тренировочный набор с непересекающимися значениями с тестовым набором. В тестовый же набор вручную отберем значения в диапазоне 6-8 тысяч регистраций. Распределение данных 80:20. 

На новых тренировочных данных LightGBM показал значение MAE = 1886.54.

На тестовом наборе данных MAE составлял 791.33. 


Таким образом, лучшей моделью оказался LightGBM. Предсказание на август 2022 года на основе данных после изменения тренировочного и тестового набора - 7752. Это значение оставляет желать лучшего, можно улучшить работоспособность модели, если получить полную информацию о датасете с дополнительными событиями, которые помогли бы предсказывать значения количества регистраций. 


![Table_4](https://github.com/Norlet/Kaggle-Competitions/blob/main/eLama/images/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B04.PNG)

